{
  "entities": {
    "Project": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Project",
      "type": "object",
      "description": "Represents a project within the MARCUS Automation Suite.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Project entity."
        },
        "projectName": {
          "type": "string",
          "description": "The name of the project."
        },
        "scopeOfWork": {
          "type": "string",
          "description": "A description of the work to be performed for the project."
        },
        "metroCode": {
          "type": "string",
          "description": "The metro code associated with the project."
        },
        "contractorTypeId": {
          "type": "string",
          "description": "Reference to ContractorType. (Relationship: Project 1:N ContractorType)"
        },
        "estimatedBudget": {
          "type": "number",
          "description": "The estimated budget for the project."
        },
        "startDate": {
          "type": "string",
          "description": "The start date of the project.",
          "format": "date-time"
        },
        "technicalDocumentIds": {
          "type": "array",
          "description": "References to TechnicalDocuments. (Relationship: Project 1:N TechnicalDocument)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "projectName",
        "scopeOfWork",
        "metroCode",
        "contractorTypeId",
        "estimatedBudget",
        "startDate"
      ]
    },
    "ContractorType": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ContractorType",
      "type": "object",
      "description": "Represents a type of contractor (e.g., electrical, plumbing).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ContractorType entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the contractor type."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "Contractor": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Contractor",
      "type": "object",
      "description": "Represents a contractor that can bid on projects.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Contractor entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the contractor."
        },
        "contactInformation": {
          "type": "string",
          "description": "Contact details for the contractor (e.g., email, phone number)."
        },
        "metroCodes": {
          "type": "array",
          "description": "Metro codes the contractor services.",
          "items": {
            "type": "string"
          }
        },
        "contractorTypeIds": {
          "type": "array",
          "description": "References to ContractorTypes. (Relationship: Contractor N:N ContractorType)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "name",
        "contactInformation"
      ]
    },
    "TechnicalDocument": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TechnicalDocument",
      "type": "object",
      "description": "Represents a technical document associated with a project.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the TechnicalDocument entity."
        },
        "documentName": {
          "type": "string",
          "description": "The name of the technical document."
        },
        "fileUri": {
          "type": "string",
          "description": "The URI where the technical document can be accessed.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "documentName",
        "fileUri"
      ]
    },
    "RFP": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "RFP",
      "type": "object",
      "description": "Represents a Request for Proposal.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the RFP entity."
        },
        "projectId": {
          "type": "string",
          "description": "Reference to Project. (Relationship: RFP 1:1 Project)"
        },
        "instructions": {
          "type": "string",
          "description": "Project-specific instructions for the RFP."
        },
        "contractorIds": {
          "type": "array",
          "description": "References to Contractors who are invited to the RFP. (Relationship: RFP 1:N Contractor)",
          "items": {
            "type": "string"
          }
        },
        "submissionDueDate": {
          "type": "string",
          "description": "The date and time by which proposals must be submitted.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "projectId",
        "instructions",
        "submissionDueDate"
      ]
    },
    "Proposal": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Proposal",
      "type": "object",
      "description": "Represents a proposal submitted by a contractor.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Proposal entity."
        },
        "rfpId": {
          "type": "string",
          "description": "Reference to RFP. (Relationship: Proposal 1:1 RFP)"
        },
        "contractorId": {
          "type": "string",
          "description": "Reference to Contractor. (Relationship: Proposal 1:1 Contractor)"
        },
        "submissionDate": {
          "type": "string",
          "description": "The date and time the proposal was submitted.",
          "format": "date-time"
        },
        "safetyScore": {
          "type": "number",
          "description": "Safety Score"
        },
        "experienceScore": {
          "type": "number",
          "description": "Experience Score"
        },
        "programmaticApproachScore": {
          "type": "number",
          "description": "Programmatic Approach Score"
        },
        "commercialExcellenceScore": {
          "type": "number",
          "description": "Commercial Excellence Score"
        },
        "innovativeSolutionsScore": {
          "type": "number",
          "description": "Innovative Solutions Score"
        },
        "missionCriticalExperienceScore": {
          "type": "number",
          "description": "Mission Critical Experience Score"
        },
        "fileUri": {
          "type": "string",
          "description": "The URI where the proposal document can be accessed.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "rfpId",
        "contractorId",
        "submissionDate",
        "fileUri"
      ]
    },
    "Feedback": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Feedback",
      "type": "object",
      "description": "Represents feedback collected from stakeholders or contractors.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Feedback entity."
        },
        "projectId": {
          "type": "string",
          "description": "Reference to Project. (Relationship: Feedback 1:N Project)"
        },
        "feedbackProviderType": {
          "type": "string",
          "description": "The type of feedback provider (e.g., stakeholder, contractor)."
        },
        "feedbackText": {
          "type": "string",
          "description": "The text of the feedback provided."
        },
        "feedbackDate": {
          "type": "string",
          "description": "The date and time the feedback was submitted.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "projectId",
        "feedbackProviderType",
        "feedbackText",
        "feedbackDate"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/projects/{projectId}",
        "definition": {
          "entityName": "Project",
          "schema": {
            "$ref": "#/backend/entities/Project"
          },
          "description": "Stores project data. Includes denormalized 'ownerId' if needed for authorization independence in subcollections.",
          "params": [
            {
              "name": "projectId",
              "description": "Unique identifier for the project."
            }
          ]
        }
      },
      {
        "path": "/contractorTypes/{contractorTypeId}",
        "definition": {
          "entityName": "ContractorType",
          "schema": {
            "$ref": "#/backend/entities/ContractorType"
          },
          "description": "Stores contractor type data.",
          "params": [
            {
              "name": "contractorTypeId",
              "description": "Unique identifier for the contractor type."
            }
          ]
        }
      },
      {
        "path": "/contractors/{contractorId}",
        "definition": {
          "entityName": "Contractor",
          "schema": {
            "$ref": "#/backend/entities/Contractor"
          },
          "description": "Stores contractor data.",
          "params": [
            {
              "name": "contractorId",
              "description": "Unique identifier for the contractor."
            }
          ]
        }
      },
      {
        "path": "/technicalDocuments/{technicalDocumentId}",
        "definition": {
          "entityName": "TechnicalDocument",
          "schema": {
            "$ref": "#/backend/entities/TechnicalDocument"
          },
          "description": "Stores technical document data.",
          "params": [
            {
              "name": "technicalDocumentId",
              "description": "Unique identifier for the technical document."
            }
          ]
        }
      },
      {
        "path": "/rfps/{rfpId}",
        "definition": {
          "entityName": "RFP",
          "schema": {
            "$ref": "#/backend/entities/RFP"
          },
          "description": "Stores RFP data. Includes 'contractorIds' for authorization independence.",
          "params": [
            {
              "name": "rfpId",
              "description": "Unique identifier for the RFP."
            }
          ]
        }
      },
      {
        "path": "/proposals/{proposalId}",
        "definition": {
          "entityName": "Proposal",
          "schema": {
            "$ref": "#/backend/entities/Proposal"
          },
          "description": "Stores proposal data.",
          "params": [
            {
              "name": "proposalId",
              "description": "Unique identifier for the proposal."
            }
          ]
        }
      },
      {
        "path": "/feedback/{feedbackId}",
        "definition": {
          "entityName": "Feedback",
          "schema": {
            "$ref": "#/backend/entities/Feedback"
          },
          "description": "Stores feedback data.",
          "params": [
            {
              "name": "feedbackId",
              "description": "Unique identifier for the feedback."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the MARCUS Automation Suite, emphasizing security, scalability, and ease of debugging.  The structure adheres to the core design principles of Authorization Independence, Clarity of Intent, DBAC (Database-Based Access Control), QAPs (Rules are not Filters), and Invariants.\n\n**Authorization Independence:**\nTo achieve authorization independence, key authorization data is denormalized.  For instance, if access to RFPs needs to be restricted based on Project ownership, the project owner information is copied into the RFP documents. This eliminates the need for `get()` calls in security rules, enabling atomic operations and simplifying debugging. Contractor role information is not defined; thus, contractor authorization is assumed to be at the RFP level. In cases where ownership is explicit, such as projects, no denormalization is needed since rules can easily validate based on the path.\n\n**Structural Segregation (Homogeneous Security Posture):**\nThe data is segregated based on access needs. For example, Project, ContractorType, Contractor, TechnicalDocument, RFP, Proposal, and Feedback data are stored in top-level collections, each with specific security requirements.  This simplifies security rules by avoiding mixing data with different access needs within the same collection.\n\n**Access Modeling (Standardization and Consistency):**\n*   **Path-Based Ownership:** Projects are stored at the root level `/projects/{projectId}`. This allows for efficient access and avoids unnecessary nesting.\n*   **Collaborative Data:**  RFPs include a `contractorIds` array which acts as a membership list defining authorized contractors. This allows for efficient list operations by filtering on allowed contractors.\n\n**QAPs (Rules are not Filters):**\nThe structure enables secure `list` operations by using structural segregation. For example, listing RFPs can be secured by verifying if the requesting user's ID is present in the `contractorIds` array within each RFP document.  This ensures that the user is authorized to view the listed documents without filtering the results based on client-side logic.\n\n**Invariants:**\nTimestamps for creation and modification can be added within documents and managed by server-side functions, ensuring data integrity."
  }
}